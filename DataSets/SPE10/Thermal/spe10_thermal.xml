<?xml version="1.0" ?>

<Problem>
  <Solvers>
    <CompositionalMultiphaseFVM
      name="compflow"
      logLevel="1"
      discretization="fluidTPFA"
      temperature="368.15"
      useMass="1"
      isThermal="1"
      logLevel="1"
      initialDt="5e4"
      maxCompFractionChange="0.5"
      targetRegions="{ region }">
      <NonlinearSolverParameters
        newtonTol="1.0e-4"
        newtonMaxIter="20"
        lineSearchAction="None"
        maxTimeStepCuts="5"/>
      <LinearSolverParameters
        solverType="gmres"
        preconditionerType="mgr"
	krylovTol="1e-6"
        logLevel="1"/>
    </CompositionalMultiphaseFVM>
  </Solvers>

  <Mesh>
    <InternalMesh
      name="mesh1"
      elementTypes="{ C3D8 }"
      xCoords="{ 0, 365.76 }"
      yCoords="{ 0, 670.56 }"
      zCoords="{ 0, 30.5 }"
      nx="{ 60 }"
      ny="{ 220 }"
      nz="{ 50 }"
      cellBlockNames="{ cb }"/>
  </Mesh>

  <Geometry>

    <Box
      name="source"
      xMin="{ 182.85, 335.25, -0.01 }"
      xMax="{ 189.00, 338.35, 2.00 }"/>
    <!-- <Box
      name="sink1"
      xMin="{ -0.01, -0.01, -0.01 }"
      xMax="{ 6.126, 3.078, 2.00 }"/>
    <Box
      name="sink2"
      xMin="{ -0.01, 667.482, -0.01 }"
      xMax="{ 6.126, 670.60, 2.00 }"/>
    <Box
      name="sink3"
      xMin="{ 359.634, -0.01, -0.01 }"
      xMax="{ 365.8, 3.048, 2.00 }"/>
    <Box
      name="sink4"
      xMin="{ 359.634, 667.482, -0.01 }"
      xMax="{ 365.8, 670.60, 2.00 }"/> -->
    
  </Geometry>

  <Events
    maxTime="1e7">
    <!-- <PeriodicEvent -->
    <!--   name="outputs" -->
    <!--   timeFrequency="1e5" -->
    <!--   target="/Outputs/vtkOutput"/> -->

    <PeriodicEvent
      name="solverApplications"
      maxEventDt="5e4"
      target="/Solvers/compflow"/>
  </Events>

  <NumericalMethods>
    <FiniteVolume>
      <TwoPointFluxApproximation
        name="fluidTPFA"/>
    </FiniteVolume>
  </NumericalMethods>

  <ElementRegions>
    <CellElementRegion
      name="region"
      cellBlocks="{ cb }"
      materialList="{ fluid, rock, relperm, thermalCond }"/>
  </ElementRegions>

   <Included>
	<File name="./cond.xml"/>
   </Included>

  <FieldSpecifications>
    <FieldSpecification
      name="initialPressure"
      initialCondition="1"
      setNames="{ all }"
      objectPath="ElementRegions/region/cb"
      fieldName="pressure"
      scale="9e6"/>
    <FieldSpecification
      name="initialTemperature"
      initialCondition="1"
      setNames="{ all }"
      objectPath="ElementRegions/region/cb"
      fieldName="temperature"
      scale="368.15"/>
    <FieldSpecification
      name="initialComposition_co2"
      initialCondition="1"
      setNames="{ all }"
      objectPath="ElementRegions/region/cb"
      fieldName="globalCompFraction"
      component="0"
      scale="0.005"/>
    <FieldSpecification
      name="initialComposition_water"
      initialCondition="1"
      setNames="{ all }"
      objectPath="ElementRegions/region/cb"
      fieldName="globalCompFraction"
      component="1"
      scale="0.995"/>

    <!-- <FieldSpecification
      name="sinkPressure"
      setNames="{ sink1, sink2, sink3, sink4 }"       
      objectPath="ElementRegions/region/cb"
      fieldName="pressure"
      scale="7e6"/>
    <FieldSpecification
      name="sink1Temperature"
      setNames="{ sink1, sink2, sink3, sink4 }"       
      objectPath="ElementRegions/region/cb"
      fieldName="temperature"
      scale="368.15"/>
     <FieldSpecification
      name="sink1TermComposition_co2"
      setNames="{ sink1, sink2, sink3, sink4 }"       
      objectPath="ElementRegions/region/cb"
      fieldName="globalCompFraction"
      component="0"
      scale="0.005"/>
    <FieldSpecification
      name="sink1TermComposition_water"
      setNames="{ sink1, sink2, sink3, sink4 }"       
      objectPath="ElementRegions/region/cb"
      fieldName="globalCompFraction"
      component="1"
      scale="0.995"/> -->

    <SourceFlux
            name="sourceTerm"
            objectPath="ElementRegions/region/cb"
            component="0"
            scale="-0.3"
            setNames="{ source }"/>
    <FieldSpecification
      name="sourceTemperature"
      setNames="{ source }"     
      objectPath="ElementRegions/region/cb"
      fieldName="temperature"
      scale="300.15"/>
      
    <!-- <FieldSpecification
      name="sourcePressure"
      setNames="{ source }"     
      objectPath="ElementRegions/region/cb"
      fieldName="pressure"
      scale="1.3e7"/>
    <FieldSpecification
      name="sourceTemperature"
      setNames="{ source }"     
      objectPath="ElementRegions/region/cb"
      fieldName="temperature"
      scale="300.15"/>
    <FieldSpecification
      name="sourceTermComposition_co2"
      setNames="{ source }"
      objectPath="ElementRegions/region/cb"
      fieldName="globalCompFraction"
      component="0"
      scale="0.995"/>
    <FieldSpecification
      name="sourceTermComposition_water"
      setNames="{ source }"
      objectPath="ElementRegions/region/cb"
      fieldName="globalCompFraction"
      component="1"
      scale="0.005"/> -->

    <FieldSpecification
      name="permx"
      component="0"
      initialCondition="1"
      setNames="{ all }"
      objectPath="ElementRegions/region/cb"
      fieldName="rockPerm_permeability"
      functionName="permxFunc"
      scale="9.869233e-16"/>
    <FieldSpecification
      name="permy"
      component="1"
      initialCondition="1"
      setNames="{ all }"
      objectPath="ElementRegions/region/cb"
      fieldName="rockPerm_permeability"
      functionName="permyFunc"
      scale="9.869233e-16"/>
    <FieldSpecification
      name="permz"
      component="2"
      initialCondition="1"
      setNames="{ all }"
      objectPath="ElementRegions/region/cb"
      fieldName="rockPerm_permeability"
      functionName="permzFunc"
      scale="9.869233e-16"/>

    <FieldSpecification
      name="referencePorosity"
      initialCondition="1"
      setNames="{ all }"
      objectPath="ElementRegions/region/cb"
      fieldName="rockPorosity_referencePorosity"
      functionName="poroFunc"
      scale="1.0"/>
  </FieldSpecifications>

  <Functions>
    <TableFunction 
      name="permxFunc"
      inputVarNames="{elementCenter}"
      coordinateFiles="{xlin.geos,ylin.geos,zlin.geos}"
      voxelFile="permx.geos"
      interpolation="linear" />
    <TableFunction 
      name="permyFunc"
      inputVarNames="{elementCenter}"
      coordinateFiles="{xlin.geos,ylin.geos,zlin.geos}"
      voxelFile="permy.geos"
      interpolation="linear" />
    <TableFunction 
      name="permzFunc"
      inputVarNames="{elementCenter}"
      coordinateFiles="{xlin.geos,ylin.geos,zlin.geos}"
      voxelFile="permz.geos"
      interpolation="linear" />
    <TableFunction 
      name="poroFunc"
      inputVarNames="{elementCenter}"
      coordinateFiles="{xlin.geos,ylin.geos,zlin.geos}"
      voxelFile="poro.geos"
      interpolation="linear" />
  </Functions>

  <Outputs>
    <VTK
      name="vtkOutput"/>

    <Restart
      name="sidreRestart"/>
  </Outputs>
</Problem>
